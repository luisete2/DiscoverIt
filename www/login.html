<!DOCTYPE html>
<html>
    <head>
        <title>DiscoverIt - Una nueva forma de viajar</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <link rel="stylesheet" type="text/css" href="css/jquery.mobile.flatui.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/themes/smoothness/jquery-ui.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/jquery-ui.min.js"></script>
        <script src="http://spin.js.org/spin.js" type="text/javascript"></script>
        <script src="http://spin.js.org/jquery.spin.js" type="text/javascript"></script>
        <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
        <script src="https://use.fontawesome.com/9aa9f12b68.js"></script>
    </head>
    <body>
        <div data-role="page" id="landingPage" data-theme="d">
            <div data-role="header">
                <h1>¡Bienvenido!</h1>
            </div><!-- /header -->
            <div data-role="content">
                <p><b>Usuarios existentes</b></p>
                <a data-role="button" href="#loginPage">Iniciar sesión</a>
                <p><b>¿Aún no te has registrado?</b></p>
                <a data-role="button" href="#signUpPage">Registro</a>
                <p></p>
            </div><!-- /content -->
        </div><!-- /page -->
        <div data-role="page" id="loginPage" data-theme="d">
            <div data-role="header">
                <a data-rel="back" data-icon="carat-l">Volver</a>
                <h1>Iniciar sesión</h1>
            </div><!-- /header -->
            <div data-role="content">
                <label for="log-email">E-Mail</label>
                <input type="text" name="log-email" id="log-email" value="">
                <label for="log-password">Contraseña</label>
                <input type="password" name="log-password" id="log-password" value="">
                <fieldset data-role="controlgroup">
                    <input type="checkbox" name="chck-rememberme" id="chck-rememberme" checked="">
                    <label for="chck-rememberme">Recuérdame</label>
                </fieldset>
                <button name="iniciarSesion" onclick="confirmLogin()">Iniciar sesión</button>
                <a data-role="button" href="#resetPasswordPage">¿No puedes entrar?</a>
            </div><!-- /content -->
        </div>
        <div data-role="page" id="signUpPage" data-theme="d">
            <div data-role="header">
                <a data-rel="back" data-icon="carat-l">Volver</a>
                <h1>Registro</h1>
            </div><!-- /header -->
            <div data-role="content">
                <label for="username">Nombre de usuario</label>
                <input type="text" id="username" name="username" value="">
                <label for="email">E-Mail</label>
                <input type="text" id="email" name="email" value="">
                <label for="password">Contraseña</label>
                <input type="password" id="password" name="password" value="">
                <label for="password-confirm">Confirma contraseña</label>
                <input type="password" id="password-confirm" name="password-confirm" value="">
                <button onclick="confirmRegistry()" name="confirmarRegistro">Confirmar registro</button>
                <!--<div data-role="popup" id="dlg-sign-up-sent" data-dismissible="false" style="max-width:400px;">
                    <div data-role="header">
                        <h1>Almost done...</h1>
                    </div>
                    <div role="main" class="ui-content">
                        <h3>Confirm Your Email Address</h3>
                        <p>We sent you an email with instructions on how to confirm your email address. Please check your inbox and follow the instructions in the email.</p>
                        <div class="mc-text-center"><a href="sign-in.html" class="ui-btn ui-corner-all ui-shadow ui-btn-b mc-top-margin-1-5">OK</a></div>
                    </div>
                </div>-->
            </div><!-- /content -->
        </div>
        <div data-role="page" id="resetPasswordPage" data-theme="d">
            <div data-role="header">
                <h1>Nueva contraseña</h1>
            </div><!-- /header -->
            <div data-role="content">
                <h3>Reestablecer contraseña</h3>
                <label for="tmp-password">Contraseña provisional</label>
                <input type="password" id="tmp-password" value="">
                <label for="new-password">Nueva contraseña</label>
                <input type="password" id="new-password" value="">
                <label for="new-password-confirm">Confirmar nueva contraseña</label>
                <input type="password" id="new-password-confirm" value="">
                <a data-role="button" href="#dlg-pwd-changed" data-rel="popup" data-transition="pop" data-position-to="window">Confirmar</a>
                <div data-role="popup" id="dlg-pwd-changed" data-dismissible="false" style="max-width:400px;">
                    <div data-role="header">
                        <h1>¡Hecho!</h1>
                    </div>
                    <div role="main" class="ui-content">
                        <p>Contraseña cambiada con éxito.</p>
                        <div><a href="#loginPage" class="ui-btn ui-corner-all ui-shadow ui-btn-b mc-top-margin-1-5">OK</a></div>
                    </div>
                </div>
            </div><!-- /content -->
        </div><!-- /page -->
    </body>
    <script>
        $.fn.spin.presets.loading = {
            lines: 15, length: 41, width: 14, radius: 42, scale: 0.75, corners: 1, color: '#000', opacity: 0.25, rotate: 0, direction: 1, speed: 1, trail: 60, fps: 20, zIndex: 2e9, className: 'spinner', top: '50%', left: '50%', shadow: true, hwaccel: false, position: 'absolute'
        };
        var url='http://192.168.1.39/DiscoverIt/www/php/';
        function confirmRegistry () {
            if(document.getElementById('username').value){
                if(emailAddressIsValid(document.getElementById('email').value)==true){
                    if(!document.getElementById('password').value){
                        window.alert('Por favor, introduce una contraseña');
                    }else if(document.getElementById('password').value != document.getElementById('password-confirm').value){
                        window.alert('¡Las contraseñas no coinciden!');
                    }else{
                        $('#signUpPage').spin('loading');
                        $.post(url+'di_loginFunctions.php', {
                            username: document.getElementById('username').value,
                            email: document.getElementById('email').value,
                            password: document.getElementById('password').value,
                            confirmarRegistro: true
                        }, function(data, status) {
                            if(data=="Registro exitoso"){
                                window.alert('Usuario registrado con éxito!');
                                $.mobile.changePage("#loginPage");
                            }else{
                                window.alert('Algo ha fallado en el registro. Por favor intentelo de nuevo mas tarde.');
                            } 
                            $('#signUpPage').spin(false);
                        });  
                    }
                }else{
                    window.alert('El E-Mail introducido no es válido. Por favor, introduce uno con el formato correcto.');
                }
            }else{
                window.alert('Introduce un nombre de usuario, por favor');
            }
        };
        function confirmLogin () {
            if(document.getElementById('log-email').value){
                if(!document.getElementById('log-password').value){
                    window.alert('Introduce la contraseña, por favor');
                }else{
                    $('#loginPage').spin('loading');
                        $.post(url+'di_loginFunctions.php', {
                            email: document.getElementById('log-email').value,
                            password: document.getElementById('log-password').value,
                            iniciarSesion: true
                        }, function(data, status) {
                            //var mdata = JSON.parse(data);
                            console.log(data);
                            if(data=="Login exitoso"){
                                window.alert('¡Login realizado con éxito!');
                                window.location.replace("../www/index.html");
                            }else{
                                window.alert('Algo ha fallado en el login. Por favor intentelo de nuevo mas tarde.');
                            } 
                            $('#loginPage').spin(false);
                        });  
                }
            }else{
                window.alert('Introduce un E-Mail, por favor');
            }
        };
        var emailAddressIsValid = function (email) {
            var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(email);
        };
</script>
</html>